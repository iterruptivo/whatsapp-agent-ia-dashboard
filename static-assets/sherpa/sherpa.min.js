var Sherpa=function(t){"use strict";class e{constructor(){this.tour=null,this.currentStepIndex=0,this.overlay=null,this.spotlight=null,this.tooltip=null,this.onComplete=null,this.scrollHandler=null,this.currentHighlightedElement=null,this.dismissChecked=!1,this.handleKeydown=this.handleKeydown.bind(this),this.repositionElements=this.repositionElements.bind(this)}start(t,e){if(this.tour&&this.end(),!t||!t.steps||0===t.steps.length)return void this.log("error","Tour inv√°lido: no tiene pasos",t);this.log("info",`Iniciando tour: ${t.name}`,{id:t.id,steps:t.steps.length}),this.tour=t,this.currentStepIndex=0,this.onComplete=e||null,this.dismissChecked=!1;const s=this.tour.steps[0];if(s){this.findElement(s)||this.log("warn","Primer elemento del tour no encontrado, iniciando con skip graceful")}this.createOverlay(),this.showStep(0),document.addEventListener("keydown",this.handleKeydown),this.scrollHandler=this.repositionElements,window.addEventListener("scroll",this.scrollHandler,!0)}close(){this.tour&&(this.cleanupAllSpotlightStyles(),this.removeOverlay(),document.removeEventListener("keydown",this.handleKeydown),this.scrollHandler&&(window.removeEventListener("scroll",this.scrollHandler,!0),this.scrollHandler=null),this.tour=null,this.currentStepIndex=0,this.onComplete=null,this.currentHighlightedElement=null,this.dismissChecked=!1)}end(){this.tour&&(this.markTourCompleted(this.tour.id),this.cleanupAllSpotlightStyles(),this.removeOverlay(),document.removeEventListener("keydown",this.handleKeydown),this.scrollHandler&&(window.removeEventListener("scroll",this.scrollHandler,!0),this.scrollHandler=null),this.onComplete&&this.onComplete(),this.tour=null,this.currentStepIndex=0,this.onComplete=null,this.currentHighlightedElement=null,this.dismissChecked=!1)}nextStep(){this.tour&&(this.currentStepIndex<this.tour.steps.length-1?(this.currentStepIndex++,this.showStep(this.currentStepIndex)):this.end())}prevStep(){this.tour&&0!==this.currentStepIndex&&(this.currentStepIndex--,this.showStep(this.currentStepIndex))}skipTour(){this.close()}isTourCompleted(t){const e=localStorage.getItem("sherpa-tours-completed");if(!e)return!1;try{return JSON.parse(e).includes(t)}catch{return!1}}markTourCompleted(t){let e=[];const s=localStorage.getItem("sherpa-tours-completed");if(s)try{e=JSON.parse(s)}catch{e=[]}e.includes(t)||(e.push(t),localStorage.setItem("sherpa-tours-completed",JSON.stringify(e)))}log(t,e,s){}trySelector(t){try{const e=document.querySelectorAll(t);return 1===e.length?e[0]:e.length>1?(this.log("warn",`Selector "${t}" encontr√≥ ${e.length} elementos, usando primero`),e[0]):null}catch(e){return this.log("error",`Selector inv√°lido: ${t}`,e),null}}findElement(t){const e=this.trySelector(t.target);if(e)return e;if(t.fallbacks&&t.fallbacks.length>0)for(const e of t.fallbacks){const t=this.trySelector(e);if(t)return this.log("info",`Usando fallback: ${e}`),t}return null}showSkipMessage(t,e){this.hideSpotlight(),this.tooltip&&this.tooltip.remove(),this.tooltip=document.createElement("div"),this.tooltip.className="sherpa-tour-tooltip sherpa-tooltip-skip",this.tooltip.style.position="fixed",this.tooltip.style.top="50%",this.tooltip.style.left="50%",this.tooltip.style.transform="translate(-50%, -50%)";const s=this.tour&&e===this.tour.steps.length-1,i=this.tour?.id||"unknown";this.tooltip.innerHTML=`\n      <div class="sherpa-tour-header">\n        <h3>${t.title}</h3>\n      </div>\n      <div class="sherpa-tour-body">\n        <div class="sherpa-tooltip-skip-icon">‚ö†Ô∏è</div>\n        <p style="text-align: center;">Este elemento no est√° disponible en este momento.</p>\n        <p style="text-align: center; font-size: 12px; color: var(--sherpa-text-secondary); margin-top: 8px;">\n          ${t.target}\n        </p>\n      </div>\n      <div class="sherpa-tour-footer">\n        <div class="sherpa-tour-footer-top">\n          <div class="sherpa-tour-progress">\n            Paso ${e+1} de ${this.tour?.steps.length||0}\n          </div>\n          <div class="sherpa-tour-actions">\n            <button class="sherpa-btn sherpa-btn-secondary" data-action="skip">\n              Salir del Tour\n            </button>\n            ${s?'\n              <button class="sherpa-btn sherpa-btn-primary" data-action="finish">\n                Finalizar Tour\n              </button>\n            ':'\n              <button class="sherpa-btn sherpa-btn-primary" data-action="continue">\n                Continuar al Siguiente\n              </button>\n            '}\n          </div>\n        </div>\n        <div class="sherpa-tour-dismiss">\n          <input type="checkbox" id="sherpa-dismiss-fallback-${i}" data-tour-id="${i}">\n          <label for="sherpa-dismiss-fallback-${i}">No mostrar este tour de nuevo</label>\n        </div>\n      </div>\n    `;const n=this.tooltip.querySelector(`#sherpa-dismiss-fallback-${i}`);n&&(this.dismissChecked&&(n.checked=!0),n.addEventListener("change",()=>{this.dismissChecked=n.checked,n.checked?this.dismissTour(i):this.undismissTour(i)})),this.tooltip.querySelectorAll("[data-action]").forEach(t=>{t.addEventListener("click",t=>{const e=t.target.getAttribute("data-action");"continue"===e||"finish"===e?this.nextStep():"skip"===e&&this.skipTour()})}),document.body.appendChild(this.tooltip)}hideSpotlight(){this.spotlight&&(this.spotlight.style.display="none")}showSpotlight(){this.spotlight&&(this.spotlight.style.display="block")}async showStep(t){if(!this.tour)return;const e=this.tour.steps[t];if(!e)return;const s=this.findElement(e);if(!s)return this.log("warn",`Elemento no encontrado para paso "${e.title}"`,{target:e.target,fallbacks:e.fallbacks}),void this.showSkipMessage(e,t);this.showSpotlight();const i=s.getBoundingClientRect();i.top>=0&&i.bottom<=window.innerHeight||(s.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(t=>setTimeout(t,300))),this.updateSpotlight(s),this.updateTooltip(s,e,t)}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="sherpa-tour-overlay",this.overlay.setAttribute("role","dialog"),this.overlay.setAttribute("aria-modal","true"),this.overlay.style.background="transparent",this.overlay.style.pointerEvents="none",document.body.appendChild(this.overlay),this.spotlight=document.createElement("div"),this.spotlight.className="sherpa-tour-spotlight",document.body.appendChild(this.spotlight)}removeOverlay(){this.overlay&&(this.overlay.remove(),this.overlay=null),this.spotlight&&(this.spotlight.remove(),this.spotlight=null),this.tooltip&&(this.tooltip.remove(),this.tooltip=null)}updateSpotlight(t){if(!this.spotlight)return;this.cleanupPreviousElementStyles();const e=t.getBoundingClientRect();this.spotlight.style.top=e.top-8+"px",this.spotlight.style.left=e.left-8+"px",this.spotlight.style.width=`${e.width+16}px`,this.spotlight.style.height=`${e.height+16}px`,t.style.position="relative",t.style.zIndex="1000001",this.currentHighlightedElement=t}updateTooltip(t,e,s){this.tooltip&&this.tooltip.remove(),this.tooltip=document.createElement("div"),this.tooltip.className="sherpa-tour-tooltip";const i=this.tour&&s===this.tour.steps.length-1,n=0===s,o=this.tour?.id||"unknown";this.tooltip.innerHTML=`\n      <div class="sherpa-tour-header">\n        <h3>${e.title}</h3>\n      </div>\n      <div class="sherpa-tour-body">\n        <p>${e.content}</p>\n      </div>\n      <div class="sherpa-tour-footer">\n        <div class="sherpa-tour-footer-top">\n          <div class="sherpa-tour-progress">\n            Paso ${s+1} de ${this.tour?.steps.length||0}\n          </div>\n          <div class="sherpa-tour-actions">\n            ${n?"":'\n              <button class="sherpa-btn sherpa-btn-secondary" data-action="prev">\n                Anterior\n              </button>\n            '}\n            <button class="sherpa-btn sherpa-btn-secondary" data-action="skip">\n              Saltar\n            </button>\n            <button class="sherpa-btn sherpa-btn-primary" data-action="next">\n              ${i?"Finalizar":"Siguiente"}\n            </button>\n          </div>\n        </div>\n        <div class="sherpa-tour-dismiss">\n          <input type="checkbox" id="sherpa-dismiss-${o}" data-tour-id="${o}">\n          <label for="sherpa-dismiss-${o}">No mostrar este tour de nuevo</label>\n        </div>\n      </div>\n    `,this.tooltip.querySelectorAll("[data-action]").forEach(t=>{t.addEventListener("click",t=>{const e=t.target.getAttribute("data-action");"next"===e?this.nextStep():"prev"===e?this.prevStep():"skip"===e&&this.skipTour()})});const r=this.tooltip.querySelector(`#sherpa-dismiss-${o}`);r&&(this.dismissChecked&&(r.checked=!0),r.addEventListener("change",()=>{this.dismissChecked=r.checked,r.checked?this.dismissTour(o):this.undismissTour(o)})),document.body.appendChild(this.tooltip),this.positionTooltip(t,e.position)}positionTooltip(t,e){if(!this.tooltip)return;const s=t.getBoundingClientRect(),i=this.tooltip.getBoundingClientRect(),n=16;let o=0,r=0;switch("auto"===e&&(e=this.detectBestPosition(s,i)),e){case"top":o=s.top-i.height-n,r=s.left+s.width/2-i.width/2;break;case"bottom":o=s.bottom+n,r=s.left+s.width/2-i.width/2;break;case"left":o=s.top+s.height/2-i.height/2,r=s.left-i.width-n;break;case"right":o=s.top+s.height/2-i.height/2,r=s.right+n}r<n&&(r=n),r+i.width>window.innerWidth-n&&(r=window.innerWidth-i.width-n),o<n&&(o=n),o+i.height>window.innerHeight-n&&(o=window.innerHeight-i.height-n),this.tooltip.style.top=`${o}px`,this.tooltip.style.left=`${r}px`}detectBestPosition(t,e){const s=t.top,i=window.innerHeight-t.bottom,n=t.left,o=window.innerWidth-t.right;return i>=e.height+16?"bottom":s>=e.height+16?"top":o>=e.width+16?"right":n>=e.width+16?"left":"bottom"}repositionElements(){if(!this.tour||!this.spotlight||!this.tooltip)return;const t=this.tour.steps[this.currentStepIndex];if(!t)return;const e=this.findElement(t);e&&(this.updateSpotlight(e),this.positionTooltip(e,t.position))}handleKeydown(t){"Escape"===t.key?this.skipTour():"ArrowRight"===t.key||"Enter"===t.key?this.nextStep():"ArrowLeft"===t.key&&this.prevStep()}dismissTour(t){const e=this.getDismissedTours();e.includes(t)||(e.push(t),localStorage.setItem("sherpa-tours-dismissed",JSON.stringify(e)))}undismissTour(t){const e=this.getDismissedTours(),s=e.indexOf(t);s>-1&&(e.splice(s,1),localStorage.setItem("sherpa-tours-dismissed",JSON.stringify(e)))}getDismissedTours(){try{const t=localStorage.getItem("sherpa-tours-dismissed");return t?JSON.parse(t):[]}catch{return[]}}isTourDismissed(t){return this.getDismissedTours().includes(t)}cleanupPreviousElementStyles(){this.currentHighlightedElement&&(this.currentHighlightedElement.style.position="",this.currentHighlightedElement.style.zIndex="")}cleanupAllSpotlightStyles(){this.tour&&(this.cleanupPreviousElementStyles(),this.tour.steps.forEach(t=>{const e=this.findElement(t);e&&(e.style.position="",e.style.zIndex="")}),this.currentHighlightedElement=null)}}class s{constructor(){this.checklist=null,this.panel=null,this.isVisible=!1,this.progressData=new Map,this.loadProgress()}init(t,e){this.checklist=t,this.onItemComplete=e?.onItemComplete,this.onComplete=e?.onComplete,this.checklist.items&&this.checklist.items.forEach(t=>{t.completed=this.progressData.get(t.id)||!1})}show(){this.checklist&&(this.isVisible?this.hide():(this.isVisible=!0,this.createPanel()))}hide(){this.panel&&(this.panel.remove(),this.panel=null),this.isVisible=!1}toggle(){this.isVisible?this.hide():this.show()}completeItem(t){if(!this.checklist)return;const e=this.checklist.items.find(e=>e.id===t);e&&(e.completed=!0,this.progressData.set(t,!0),this.saveProgress(),this.panel&&(this.updatePanel(),this.animateItemCompletion(t)),this.onItemComplete?.(t),this.isAllCompleted()&&(this.showReward(),this.onComplete?.()))}reset(){this.checklist&&(this.checklist.items.forEach(t=>{t.completed=!1,this.progressData.delete(t.id)}),this.saveProgress(),this.panel&&this.updatePanel())}destroy(){this.hide(),this.checklist=null,this.onItemComplete=void 0,this.onComplete=void 0}createPanel(){if(!this.checklist)return;this.panel=document.createElement("div"),this.panel.className="sherpa-checklist-modal",this.panel.setAttribute("role","dialog"),this.panel.setAttribute("aria-modal","true"),this.panel.setAttribute("aria-labelledby","sherpa-checklist-title");const t=this.getProgress();this.panel.innerHTML=`\n      <div class="sherpa-checklist-overlay"></div>\n      <div class="sherpa-checklist-panel">\n        <div class="sherpa-header">\n          <h2 id="sherpa-checklist-title">${this.checklist.title}</h2>\n          <button class="sherpa-close" aria-label="Cerrar">&times;</button>\n        </div>\n        <div class="sherpa-checklist">\n          <div class="sherpa-checklist-header">\n            <p>${this.checklist.description}</p>\n            <div class="sherpa-checklist-progress">\n              <div class="sherpa-checklist-progress-bar" style="width: ${t}%"></div>\n            </div>\n            <div class="sherpa-checklist-progress-text">\n              ${this.getCompletedCount()} de ${this.checklist.items.length} completadas (${t}%)\n            </div>\n          </div>\n          <ul class="sherpa-checklist-items">\n            ${this.checklist.items.map(t=>this.renderItem(t)).join("")}\n          </ul>\n        </div>\n      </div>\n    `,this.panel.querySelector(".sherpa-close")?.addEventListener("click",()=>this.hide()),this.panel.querySelector(".sherpa-checklist-overlay")?.addEventListener("click",()=>this.hide()),this.checklist.items.forEach(t=>{const e=this.panel?.querySelector(`[data-item-id="${t.id}"]`);e&&e.addEventListener("click",()=>this.handleItemClick(t))});const e=t=>{"Escape"===t.key&&(this.hide(),document.removeEventListener("keydown",e))};document.addEventListener("keydown",e),document.body.appendChild(this.panel)}renderItem(t){return`\n      <li class="sherpa-checklist-item ${t.completed?"completed":""}"\n          data-item-id="${t.id}"\n          role="button"\n          tabindex="0"\n          aria-label="${t.title}">\n        <div class="sherpa-checklist-check"></div>\n        <div class="sherpa-checklist-text">\n          <strong>${t.title}</strong>\n          <p>${t.description}</p>\n        </div>\n      </li>\n    `}handleItemClick(t){if(!t.completed)switch(t.action.type){case"visit":window.location.href=t.action.target,setTimeout(()=>this.completeItem(t.id),500);break;case"click":const e=document.querySelector(t.action.target);e&&(this.hide(),setTimeout(()=>{e.click(),this.completeItem(t.id)},300));break;case"tour":this.hide(),window.dispatchEvent(new CustomEvent("sherpa:start-tour",{detail:{tourId:t.action.target}})),setTimeout(()=>this.completeItem(t.id),500);break;case"custom":window.dispatchEvent(new CustomEvent("sherpa:checklist-action",{detail:{itemId:t.id,target:t.action.target}}))}}updatePanel(){if(!this.panel||!this.checklist)return;const t=this.getProgress(),e=this.panel.querySelector(".sherpa-checklist-progress-bar");e&&(e.style.width=`${t}%`);const s=this.panel.querySelector(".sherpa-checklist-progress-text");s&&(s.textContent=`${this.getCompletedCount()} de ${this.checklist.items.length} completadas (${t}%)`),this.checklist.items.forEach(t=>{const e=this.panel?.querySelector(`[data-item-id="${t.id}"]`);e&&(t.completed?e.classList.add("completed"):e.classList.remove("completed"))})}animateItemCompletion(t){const e=this.panel?.querySelector(`[data-item-id="${t}"]`);e&&(e.classList.add("sherpa-checklist-item-completing"),setTimeout(()=>{e.classList.remove("sherpa-checklist-item-completing")},600))}showReward(){if(this.checklist?.reward)switch(this.checklist.reward.type){case"confetti":this.showConfetti();break;case"message":this.showRewardMessage(this.checklist.reward.content);break;case"badge":this.showBadge(this.checklist.reward.content)}}showConfetti(){const t=document.createElement("div");t.className="sherpa-confetti-container";for(let e=0;e<50;e++){const e=document.createElement("div");e.className="sherpa-confetti",e.style.left=100*Math.random()+"%",e.style.animationDelay=.5*Math.random()+"s",e.style.backgroundColor=this.getRandomColor(),t.appendChild(e)}document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}showRewardMessage(t){const e=document.createElement("div");e.className="sherpa-reward-message",e.innerHTML=`\n      <div class="sherpa-reward-content">\n        <div class="sherpa-reward-icon">üéâ</div>\n        <h3>¬°Felicidades!</h3>\n        <p>${t}</p>\n        <button class="sherpa-btn sherpa-btn-primary">Continuar</button>\n      </div>\n    `,e.querySelector("button")?.addEventListener("click",()=>{e.remove()}),document.body.appendChild(e)}showBadge(t){const e=document.createElement("div");e.className="sherpa-badge-award",e.innerHTML=`\n      <div class="sherpa-badge-content">\n        <div class="sherpa-badge-icon">üèÜ</div>\n        <h3>¬°Insignia Desbloqueada!</h3>\n        <p>${t}</p>\n      </div>\n    `,document.body.appendChild(e),setTimeout(()=>{e.classList.add("sherpa-badge-show")},100),setTimeout(()=>{e.classList.remove("sherpa-badge-show"),setTimeout(()=>e.remove(),300)},3e3)}getProgress(){if(!this.checklist||0===this.checklist.items.length)return 0;const t=this.getCompletedCount();return Math.round(t/this.checklist.items.length*100)}getCompletedCount(){return this.checklist?this.checklist.items.filter(t=>t.completed).length:0}isAllCompleted(){return!!this.checklist&&this.checklist.items.every(t=>t.completed)}loadProgress(){const t=localStorage.getItem("sherpa-checklist-progress");if(t)try{const e=JSON.parse(t);this.progressData=new Map(Object.entries(e))}catch{this.progressData=new Map}}saveProgress(){const t=Object.fromEntries(this.progressData);localStorage.setItem("sherpa-checklist-progress",JSON.stringify(t))}getRandomColor(){const t=["#6366f1","#ec4899","#f59e0b","#10b981","#3b82f6","#8b5cf6"];return t[Math.floor(Math.random()*t.length)]||"#6366f1"}}class i{constructor(){this.hotspots=[],this.activeHotspotElements=new Map,this.activeTooltip=null,this.handleScroll=this.handleScroll.bind(this),this.handleResize=this.handleResize.bind(this)}init(t,e){this.hotspots=t.filter(t=>this.matchesPage(t.page,e)),this.hotspots=this.hotspots.filter(t=>!t.showOnce||!this.isHotspotSeen(t.id)),this.show()}show(){this.hide(),this.hotspots.forEach(t=>{this.createHotspot(t)}),window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize)}hide(){this.activeHotspotElements.forEach(t=>t.remove()),this.activeHotspotElements.clear(),this.activeTooltip&&(this.activeTooltip.remove(),this.activeTooltip=null),window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)}destroy(){this.hide(),this.hotspots=[]}createHotspot(t){const e=document.querySelector(t.selector);if(!e)return;const s=document.createElement("div");s.className=this.getHotspotClasses(t),s.setAttribute("role","button"),s.setAttribute("tabindex","0"),s.setAttribute("aria-label",t.title),s.setAttribute("data-hotspot-id",t.id),t.style?.color&&s.style.setProperty("--hotspot-color",t.style.color),this.positionHotspot(s,e),s.addEventListener("click",()=>this.showTooltip(t,s)),s.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.showTooltip(t,s))}),document.body.appendChild(s),this.activeHotspotElements.set(t.id,s),t.showOnce&&this.markHotspotSeen(t.id)}getHotspotClasses(t){const e=["sherpa-hotspot"];if(!t.style)return e.push("sherpa-hotspot-pulse"),e.push("sherpa-hotspot-medium"),e.join(" ");const s=t.style.type||"pulse";e.push(`sherpa-hotspot-${s}`);const i=t.style.size||"medium";return e.push(`sherpa-hotspot-${i}`),e.join(" ")}positionHotspot(t,e){const s=e.getBoundingClientRect();t.style.top=s.top+window.scrollY-10+"px",t.style.left=s.right+window.scrollX-10+"px"}showTooltip(t,e){this.activeTooltip&&this.activeTooltip.remove();const s=document.createElement("div");s.className="sherpa-hotspot-tooltip",s.setAttribute("role","tooltip"),s.setAttribute("id",`sherpa-tooltip-${t.id}`),s.innerHTML=`\n      <div class="sherpa-hotspot-tooltip-header">\n        <strong>${t.title}</strong>\n        <button class="sherpa-hotspot-tooltip-close" aria-label="Cerrar">&times;</button>\n      </div>\n      <div class="sherpa-hotspot-tooltip-body">\n        ${t.content}\n      </div>\n    `,s.querySelector(".sherpa-hotspot-tooltip-close")?.addEventListener("click",()=>{s.remove(),this.activeTooltip=null});const i=t=>{!s||s.contains(t.target)||e.contains(t.target)||(s.remove(),this.activeTooltip=null,document.removeEventListener("click",i))};setTimeout(()=>document.addEventListener("click",i),0);const n=t=>{"Escape"===t.key&&(s.remove(),this.activeTooltip=null,document.removeEventListener("keydown",n))};document.addEventListener("keydown",n),document.body.appendChild(s),this.activeTooltip=s,this.positionTooltip(s,e),e.setAttribute("aria-describedby",`sherpa-tooltip-${t.id}`)}positionTooltip(t,e){const s=e.getBoundingClientRect(),i=t.getBoundingClientRect(),n=12;let o=s.bottom+n,r=s.left-i.width/2+s.width/2;r<n&&(r=n),r+i.width>window.innerWidth-n&&(r=window.innerWidth-i.width-n),o+i.height>window.innerHeight-n&&(o=s.top-i.height-n),t.style.top=`${o+window.scrollY}px`,t.style.left=`${r}px`}handleScroll(){if(this.activeHotspotElements.forEach((t,e)=>{const s=this.hotspots.find(t=>t.id===e);if(!s)return;const i=document.querySelector(s.selector);i&&this.positionHotspot(t,i)}),this.activeTooltip){const t=this.activeTooltip.id.replace("sherpa-tooltip-",""),e=this.activeHotspotElements.get(t);e&&this.positionTooltip(this.activeTooltip,e)}}handleResize(){this.handleScroll()}matchesPage(t,e){return new RegExp("^"+t.replace(/\*/g,".*")+"$").test(e)}isHotspotSeen(t){const e=localStorage.getItem("sherpa-hotspots-seen");if(!e)return!1;try{return JSON.parse(e).includes(t)}catch{return!1}}markHotspotSeen(t){let e=[];const s=localStorage.getItem("sherpa-hotspots-seen");if(s)try{e=JSON.parse(s)}catch{e=[]}e.includes(t)||(e.push(t),localStorage.setItem("sherpa-hotspots-seen",JSON.stringify(e)))}}class n{constructor(){this.config=null,this.content=null,this.container=null,this.isOpen=!1,this.initialized=!1,this.tours=[],this.tourEngine=new e,this.hotspotManager=new i,this.checklistManager=new s,this.setupChecklistListeners()}setupChecklistListeners(){window.addEventListener("sherpa:start-tour",t=>{t.detail?.tourId&&this.startTour(t.detail.tourId)})}async init(t){if(!this.initialized){this.config={position:"bottom-right",theme:"light",features:{contextualHelp:!0,tours:!0,hotspots:!0,checklist:!0,search:!0,chatAI:!1},...t};try{await this.loadContent(),this.createContainer(),this.createButton(),this.createPanel(),this.setupRouteListener(),this.setupHotspots(),this.setupChecklist(),this.checkAutoTours(),this.initialized=!0,this.config.onReady?.()}catch(t){throw this.config.onError?.(t),t}}}destroy(){this.container&&(this.container.remove(),this.container=null),this.hotspotManager.destroy(),this.checklistManager.destroy(),this.initialized=!1,this.content=null,this.config=null}showHelp(){this.initialized&&(this.isOpen=!0,this.container?.classList.add("sherpa-open"))}hideHelp(){this.initialized&&(this.isOpen=!1,this.container?.classList.remove("sherpa-open"))}startTour(t,e=!1){if(!this.initialized)return;const s=this.tours.find(e=>e.id===t);s&&(!e&&this.tourEngine.isTourDismissed(t)||!e&&this.tourEngine.isTourCompleted(t)||(this.isOpen&&this.hideHelp(),this.tourEngine.start(s,()=>{})))}showChecklist(){this.initialized&&(this.isOpen&&this.hideHelp(),this.checklistManager.show())}getPageHelp(){if(!this.content)return null;const t=window.location.pathname;return this.content.pages.find(t=>t.url===window.location.href)||this.content.pages.find(e=>this.matchUrlPattern(t,e.urlPattern))||null}async loadContent(){if(!this.config?.contentUrl)throw new Error("[Sherpa] contentUrl is required");const t=await fetch(this.config.contentUrl);if(!t.ok)throw new Error(`[Sherpa] Failed to load content: ${t.status}`);this.content=await t.json(),this.content&&this.content.tours&&(this.tours=this.content.tours)}createContainer(){this.container=document.createElement("div"),this.container.id="sherpa-widget",this.container.className=`sherpa-container sherpa-${this.config?.position} sherpa-theme-${this.config?.theme}`,document.body.appendChild(this.container)}createButton(){const t=document.createElement("button");t.className="sherpa-trigger",t.setAttribute("aria-label","Ayuda"),t.innerHTML='\n      <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">\n        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>\n      </svg>\n    ',t.addEventListener("click",()=>{this.isOpen?this.hideHelp():this.showHelp()}),this.container?.appendChild(t)}createPanel(){const t=document.createElement("div");t.className="sherpa-panel";const e=this.content?.app?.name||"Tu Aplicacion",s=this.tours.length>0;t.innerHTML=`\n      <div class="sherpa-header">\n        <div class="sherpa-header-top">\n          <div>\n            <h2>Centro de Ayuda</h2>\n            <p class="sherpa-header-subtitle">${e}</p>\n          </div>\n          <button class="sherpa-close" aria-label="Cerrar">&times;</button>\n        </div>\n      </div>\n      <div class="sherpa-content">\n        ${s?this.renderToursSection():""}\n        ${this.renderQuickHelpSection()}\n        ${this.renderContextualHelp()}\n      </div>\n      <div class="sherpa-panel-footer">\n        <div class="sherpa-widget-version">Sherpa Widget v1.0.0</div>\n      </div>\n    `,t.querySelector(".sherpa-close")?.addEventListener("click",()=>{this.hideHelp()}),this.setupPanelActionListeners(t),this.container?.appendChild(t)}setupPanelActionListeners(t){t.querySelectorAll("[data-tour-id]").forEach(t=>{const e=()=>{const e=t.getAttribute("data-tour-id");e&&this.startTour(e,!0)};t.addEventListener("click",e),t.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e())})});const e=(e,s)=>{const i=t.querySelector(e);i&&(i.addEventListener("click",s),i.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),s())}))};e('[data-action="show-contextual"]',()=>{const e=t.querySelector(".sherpa-contextual-help");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}),e('[data-action="show-videos"]',()=>{this.showComingSoon("videos")}),e('[data-action="contact-support"]',()=>{this.showComingSoon("support")})}showComingSoon(t){const e=this.container?.querySelector(".sherpa-content");if(!e)return;const s={videos:{icon:"üé¨",title:"Videos Tutoriales",message:"Estamos preparando videos tutoriales increibles para ayudarte a dominar todas las funcionalidades.",submessage:"Muy pronto tendras acceso a guias visuales paso a paso."},support:{icon:"üí¨",title:"Soporte en Vivo",message:"Nuestro equipo de soporte esta trabajando para ofrecerte la mejor experiencia de ayuda.",submessage:"Proximamente podras chatear con nuestro equipo en tiempo real."}}[t],i=e.innerHTML;e.innerHTML=`\n      <div class="sherpa-coming-soon">\n        <div class="sherpa-coming-soon-icon">${s.icon}</div>\n        <h3 class="sherpa-coming-soon-title">${s.title}</h3>\n        <div class="sherpa-coming-soon-badge">En Construccion</div>\n        <p class="sherpa-coming-soon-message">${s.message}</p>\n        <p class="sherpa-coming-soon-submessage">${s.submessage}</p>\n        <button class="sherpa-btn sherpa-btn-primary sherpa-coming-soon-back" aria-label="Volver atras">\n          ‚Üê Volver al Centro de Ayuda\n        </button>\n      </div>\n    `;const n=e.querySelector(".sherpa-coming-soon-back");n?.addEventListener("click",()=>{e.innerHTML=i;const t=this.container?.querySelector(".sherpa-panel");t&&this.setupPanelActionListeners(t)})}renderToursSection(){const t=window.location.pathname,e=this.tours.filter(e=>!e.trigger.pages||0===e.trigger.pages.length||e.trigger.pages.some(e=>e===t||(!(!e.endsWith("*")||!t.startsWith(e.slice(0,-1)))||!!("/"!==e&&e.length>1&&t.startsWith(e)))));return 0===e.length?"":`\n      <div class="sherpa-section">\n        <h3 class="sherpa-section-title">\n          <span class="sherpa-section-icon">üéØ</span>\n          Tours Guiados\n        </h3>\n        ${e.map(t=>`\n          <div class="sherpa-tour-card" data-tour-id="${t.id}" role="button" tabindex="0" aria-label="Iniciar tour: ${t.name}">\n            <div class="sherpa-tour-icon">‚ñ∂</div>\n            <div class="sherpa-tour-info">\n              <h4 class="sherpa-tour-name">${t.name}</h4>\n              <p class="sherpa-tour-description">${t.description}</p>\n            </div>\n          </div>\n        `).join("")}\n      </div>\n    `}renderQuickHelpSection(){return'\n      <div class="sherpa-section">\n        <h3 class="sherpa-section-title">\n          <span class="sherpa-section-icon">‚ö°</span>\n          Ayuda Rapida\n        </h3>\n        <div class="sherpa-quick-help-grid">\n          <div class="sherpa-quick-help-item" data-action="show-contextual" role="button" tabindex="0" aria-label="Ver ayuda contextual">\n            <span class="sherpa-quick-help-icon">üìñ</span>\n            <p class="sherpa-quick-help-label">Guias</p>\n          </div>\n          <div class="sherpa-quick-help-item" data-action="show-videos" role="button" tabindex="0" aria-label="Ver videos tutoriales">\n            <span class="sherpa-quick-help-icon">üé•</span>\n            <p class="sherpa-quick-help-label">Videos</p>\n          </div>\n          <div class="sherpa-quick-help-item" data-action="contact-support" role="button" tabindex="0" aria-label="Contactar soporte">\n            <span class="sherpa-quick-help-icon">üí¨</span>\n            <p class="sherpa-quick-help-label">Soporte</p>\n          </div>\n        </div>\n      </div>\n    '}renderContextualHelp(){const t=this.getPageHelp();return t?`\n      <div class="sherpa-section sherpa-contextual-help">\n        <h3 class="sherpa-section-title">\n          <span class="sherpa-section-icon">üìç</span>\n          ${t.title}\n        </h3>\n        <p style="color: var(--sherpa-text-secondary); font-size: 13px; margin: 0 0 12px;">${t.description}</p>\n\n        ${t.purpose?`\n          <div class="sherpa-purpose">\n            <strong>Proposito:</strong> ${t.purpose}\n          </div>\n        `:""}\n\n        ${t.tips.length>0?`\n          <div class="sherpa-tips">\n            <h4>Tips Utiles</h4>\n            <ul>\n              ${t.tips.map(t=>`<li>${t}</li>`).join("")}\n            </ul>\n          </div>\n        `:""}\n\n        ${t.elements.length>0?`\n          <div class="sherpa-elements">\n            <h4>Elementos Clave</h4>\n            ${t.elements.map(t=>`\n              <div class="sherpa-element" data-selector="${t.selector}">\n                <strong>${t.title}</strong>\n                <p>${t.description}</p>\n              </div>\n            `).join("")}\n          </div>\n        `:""}\n      </div>\n    `:'\n        <div class="sherpa-section sherpa-contextual-help">\n          <h3 class="sherpa-section-title">\n            <span class="sherpa-section-icon">üìç</span>\n            Ayuda Contextual\n          </h3>\n          <div class="sherpa-no-help">\n            <p>No hay ayuda especifica disponible para esta pagina.</p>\n          </div>\n        </div>\n      '}setupRouteListener(){const t=history.pushState,e=history.replaceState;history.pushState=(...e)=>{t.apply(history,e),this.onRouteChange()},history.replaceState=(...t)=>{e.apply(history,t),this.onRouteChange()},window.addEventListener("popstate",()=>{this.onRouteChange()})}onRouteChange(){const t=this.container?.querySelector(".sherpa-panel"),e=this.container?.querySelector(".sherpa-content");if(e){const s=this.tours.length>0;e.innerHTML=`\n        ${s?this.renderToursSection():""}\n        ${this.renderQuickHelpSection()}\n        ${this.renderContextualHelp()}\n      `,t&&this.setupPanelActionListeners(t)}this.setupHotspots(),this.checkAutoTours()}setupHotspots(){if(!this.config?.features?.hotspots)return;if(!this.content?.hotspots||0===this.content.hotspots.length)return;const t=window.location.pathname;this.hotspotManager.init(this.content.hotspots,t)}setupChecklist(){}checkAutoTours(){if(!this.config?.features?.tours)return;const t=window.location.pathname,e=this.tours.filter(e=>{if("auto"!==e.trigger.type)return!1;if(e.trigger.pages&&e.trigger.pages.length>0){if(!e.trigger.pages.some(e=>e===t||(!(!e.endsWith("*")||!t.startsWith(e.slice(0,-1)))||!!("/"!==e&&e.length>1&&t.startsWith(e)))))return!1}const s=`sherpa-tour-${e.id}`;return"completed"!==localStorage.getItem(s)&&"skipped"!==localStorage.getItem(s)&&(!this.tourEngine.isTourDismissed(e.id)&&("first-visit"!==e.trigger.condition||!this.tourEngine.isTourCompleted(e.id)))});if(e.length>0){const t=e[0];t&&setTimeout(()=>{this.startTour(t.id)},2e3)}}matchUrlPattern(t,e){const s=e.replace(/:[^/]+/g,"[^/]+").replace(/\//g,"\\/");return new RegExp(`^${s}$`).test(t)}}const o=new n;return"undefined"!=typeof window&&(window.Sherpa=o),t.Sherpa=o,t.SherpaWidget=n,t}({});
